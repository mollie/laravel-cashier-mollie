<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Subscriptions | Laravel Cashier Mollie v2</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="apple-touch-icon" sizes="180x180" href="/laravel-cashier-mollie/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/laravel-cashier-mollie/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/laravel-cashier-mollie/favicon-16x16.png">
    <link rel="manifest" href="/laravel-cashier-mollie/manifest.json">
    <script src="https://cdn.usefathom.com/script.js" spa="auto" site="ANMLOYPH" defer="true"></script>
    <meta name="description" content="Laravel Cashier provides an expressive, fluent interface to subscriptions using Mollie's billing services.">
    <meta property="og:site_name" content="Laravel Cashier Mollie v2">
    <meta property="og:title" content="Subscriptions">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://www.cashiermollie.com/02-subscriptions.html">
    <meta property="og:image" content="https://sandorianhq.github.io/laravel-cashier-mollie/assets/pages/laravelcashiermollie.jpg">
    <meta name="twitter:title" content="Subscriptions">
    <meta name="twitter:url" content="https://www.cashiermollie.com/02-subscriptions.html">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="https://sandorianhq.github.io/laravel-cashier-mollie/assets/pages/laravelcashiermollie.jpg">
    <meta name="twitter:label1" content="Written by">
    <meta name="twitter:data1" content="Mollie.com">
    <meta name="theme-color" content="#ffffff">
    <meta name="viewport" content="width=device-width">
    
    <link rel="preload" href="/laravel-cashier-mollie/assets/css/0.styles.bfbd43d6.css" as="style"><link rel="preload" href="/laravel-cashier-mollie/assets/js/app.d194e643.js" as="script"><link rel="preload" href="/laravel-cashier-mollie/assets/js/2.9546977a.js" as="script"><link rel="preload" href="/laravel-cashier-mollie/assets/js/11.400a032b.js" as="script"><link rel="preload" href="/laravel-cashier-mollie/assets/js/3.48b18616.js" as="script"><link rel="prefetch" href="/laravel-cashier-mollie/assets/js/10.8905d9e9.js"><link rel="prefetch" href="/laravel-cashier-mollie/assets/js/12.199a7f12.js"><link rel="prefetch" href="/laravel-cashier-mollie/assets/js/13.330ecb83.js"><link rel="prefetch" href="/laravel-cashier-mollie/assets/js/14.1bf3ff44.js"><link rel="prefetch" href="/laravel-cashier-mollie/assets/js/15.65f8d738.js"><link rel="prefetch" href="/laravel-cashier-mollie/assets/js/16.aac1270d.js"><link rel="prefetch" href="/laravel-cashier-mollie/assets/js/17.102c2308.js"><link rel="prefetch" href="/laravel-cashier-mollie/assets/js/18.886d7d4c.js"><link rel="prefetch" href="/laravel-cashier-mollie/assets/js/19.020abfed.js"><link rel="prefetch" href="/laravel-cashier-mollie/assets/js/20.13bdeb92.js"><link rel="prefetch" href="/laravel-cashier-mollie/assets/js/21.8c1448d8.js"><link rel="prefetch" href="/laravel-cashier-mollie/assets/js/22.cd1acc54.js"><link rel="prefetch" href="/laravel-cashier-mollie/assets/js/23.dd88ba55.js"><link rel="prefetch" href="/laravel-cashier-mollie/assets/js/24.631a59a4.js"><link rel="prefetch" href="/laravel-cashier-mollie/assets/js/4.39f8c929.js"><link rel="prefetch" href="/laravel-cashier-mollie/assets/js/5.0239c790.js"><link rel="prefetch" href="/laravel-cashier-mollie/assets/js/6.7aeb4e0b.js"><link rel="prefetch" href="/laravel-cashier-mollie/assets/js/7.ebdaec88.js"><link rel="prefetch" href="/laravel-cashier-mollie/assets/js/8.87bb0e49.js"><link rel="prefetch" href="/laravel-cashier-mollie/assets/js/9.b1a9c499.js">
    <link rel="stylesheet" href="/laravel-cashier-mollie/assets/css/0.styles.bfbd43d6.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/laravel-cashier-mollie/" class="home-link router-link-active"><img src="/laravel-cashier-mollie/assets/img/cashier-mollie.svg" alt="Laravel Cashier Mollie v2" class="logo"> <span class="site-name can-hide">Laravel Cashier Mollie v2</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"> <a href="https://github.com/sandorianHQ/laravel-cashier-mollie" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/sandorianHQ/laravel-cashier-mollie" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/laravel-cashier-mollie/" aria-current="page" class="sidebar-link">Introduction</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/laravel-cashier-mollie/00-installation.html" class="sidebar-link">Early release installation</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/laravel-cashier-mollie/00-installation.html#installation" class="sidebar-link">Installation</a></li><li class="sidebar-sub-header"><a href="/laravel-cashier-mollie/00-installation.html#setup" class="sidebar-link">Setup</a></li></ul></li><li><a href="/laravel-cashier-mollie/13-upgrade.html" class="sidebar-link">Upgrade Guide</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/laravel-cashier-mollie/13-upgrade.html#upgrading-to-2-0-from-1-x" class="sidebar-link">Upgrading To 2.0 From 1.x</a></li></ul></li><li><a href="/laravel-cashier-mollie/02-subscriptions.html" aria-current="page" class="active sidebar-link">Subscriptions</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/laravel-cashier-mollie/02-subscriptions.html#creating-subscriptions" class="sidebar-link">Creating subscriptions</a></li><li class="sidebar-sub-header"><a href="/laravel-cashier-mollie/02-subscriptions.html#coupons" class="sidebar-link">Coupons</a></li><li class="sidebar-sub-header"><a href="/laravel-cashier-mollie/02-subscriptions.html#checking-subscription-status" class="sidebar-link">Checking subscription status</a></li><li class="sidebar-sub-header"><a href="/laravel-cashier-mollie/02-subscriptions.html#cancelled-subscription-status" class="sidebar-link">Cancelled subscription status</a></li><li class="sidebar-sub-header"><a href="/laravel-cashier-mollie/02-subscriptions.html#changing-plans" class="sidebar-link">Changing plans</a></li><li class="sidebar-sub-header"><a href="/laravel-cashier-mollie/02-subscriptions.html#subscription-quantity" class="sidebar-link">Subscription quantity</a></li><li class="sidebar-sub-header"><a href="/laravel-cashier-mollie/02-subscriptions.html#subscription-taxes" class="sidebar-link">Subscription taxes</a></li><li class="sidebar-sub-header"><a href="/laravel-cashier-mollie/02-subscriptions.html#cancelling-subscriptions" class="sidebar-link">Cancelling subscriptions</a></li><li class="sidebar-sub-header"><a href="/laravel-cashier-mollie/02-subscriptions.html#resuming-subscriptions" class="sidebar-link">Resuming subscriptions</a></li></ul></li><li><a href="/laravel-cashier-mollie/03-trials.html" class="sidebar-link">Subscription Trials</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/laravel-cashier-mollie/03-trials.html#with-mandate-upfront" class="sidebar-link">With mandate upfront</a></li><li class="sidebar-sub-header"><a href="/laravel-cashier-mollie/03-trials.html#without-mandate-upfront" class="sidebar-link">Without mandate upfront</a></li></ul></li><li><a href="/laravel-cashier-mollie/04-charges.html" class="sidebar-link">One-time charges</a></li><li><a href="/laravel-cashier-mollie/05-metered.html" class="sidebar-link">Metered billing</a></li><li><a href="/laravel-cashier-mollie/06-customer.html" class="sidebar-link">Customer</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/laravel-cashier-mollie/06-customer.html#updating-customer-payment-method" class="sidebar-link">Updating customer payment method</a></li><li class="sidebar-sub-header"><a href="/laravel-cashier-mollie/06-customer.html#customer-balance" class="sidebar-link">Customer balance</a></li><li class="sidebar-sub-header"><a href="/laravel-cashier-mollie/06-customer.html#customer-locale" class="sidebar-link">Customer locale</a></li></ul></li><li><a href="/laravel-cashier-mollie/07-invoices.html" class="sidebar-link">Invoices</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/laravel-cashier-mollie/07-invoices.html#finding-a-specific-invoice" class="sidebar-link">Finding a specific invoice</a></li></ul></li><li><a href="/laravel-cashier-mollie/08-refunds.html" class="sidebar-link">Refunds</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/laravel-cashier-mollie/08-refunds.html#complete-refund" class="sidebar-link">Complete refund</a></li><li class="sidebar-sub-header"><a href="/laravel-cashier-mollie/08-refunds.html#advanced-refunds" class="sidebar-link">Advanced refunds</a></li></ul></li><li><a href="/laravel-cashier-mollie/14-retry.html" class="sidebar-link">Handling failed payments</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/laravel-cashier-mollie/14-retry.html#subscriptions-and-failed-payments" class="sidebar-link">Subscriptions and failed payments</a></li></ul></li><li><a href="/laravel-cashier-mollie/09-events.html" class="sidebar-link">Events</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/laravel-cashier-mollie/10-webhook.html" class="sidebar-link">Mollie webhook event handling</a></li><li><a href="/laravel-cashier-mollie/11-testing.html" class="sidebar-link">Testing</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/laravel-cashier-mollie/11-testing.html#enable-mollie-integration-tests" class="sidebar-link">Enable Mollie integration tests</a></li></ul></li><li><a href="/laravel-cashier-mollie/12-faq.html" class="sidebar-link">F.A.Q.</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/laravel-cashier-mollie/12-faq.html#ok-so-how-does-this-subscription-magic-actually-work" class="sidebar-link">Ok. So how does this subscription magic actually work?</a></li><li class="sidebar-sub-header"><a href="/laravel-cashier-mollie/12-faq.html#my-billable-model-uses-uuids-how-can-i-get-cashier-mollie-to-work-with-this" class="sidebar-link">My billable model uses UUIDs, how can I get Cashier Mollie to work with this?</a></li><li class="sidebar-sub-header"><a href="/laravel-cashier-mollie/12-faq.html#how-is-prorating-handled" class="sidebar-link">How is prorating handled?</a></li><li class="sidebar-sub-header"><a href="/laravel-cashier-mollie/12-faq.html#how-can-i-load-coupons-and-or-plans-from-the-database" class="sidebar-link">How can I load coupons and/or plans from the database?</a></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="subscriptions"><a href="#subscriptions" class="header-anchor">#</a> Subscriptions</h1> <h2 id="creating-subscriptions"><a href="#creating-subscriptions" class="header-anchor">#</a> Creating subscriptions</h2> <p>To create a subscription, first retrieve an instance of your billable model, which typically will be an instance of
<code>App\Models\User</code>. Once you have retrieved the model instance, you may use the <code>newSubscription</code> method to create the model's
subscription:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Models<span class="token punctuation">\</span>User</span><span class="token punctuation">;</span>

<span class="token variable">$user</span> <span class="token operator">=</span> <span class="token class-name class-name-fully-qualified static-context">App<span class="token punctuation">\</span>User</span><span class="token operator">::</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Make sure to configure the 'premium' plan in config/cashier_plans.php</span>
<span class="token variable">$result</span> <span class="token operator">=</span> <span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token function">newSubscription</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'main'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'premium'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>If the customer already has a valid Mollie mandate, the <code>$result</code> will be a <code>Subscription</code>.</p> <p>If the customer has no valid Mollie mandate yet, the <code>$result</code> will be a <code>RedirectToCheckoutResponse</code>, redirecting the
customer to the Mollie checkout to make the first payment. Once the payment has been received the subscription will
start.</p> <h3 id="example-subscription-controller"><a href="#example-subscription-controller" class="header-anchor">#</a> Example subscription controller</h3> <p>Here's a basic controller example for creating the subscription:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Controllers</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Laravel<span class="token punctuation">\</span>Cashier<span class="token punctuation">\</span>SubscriptionBuilder<span class="token punctuation">\</span>RedirectToCheckoutResponse</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Support<span class="token punctuation">\</span>Facades<span class="token punctuation">\</span>Auth</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">CreateSubscriptionController</span> <span class="token keyword">extends</span> <span class="token class-name">Controller</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
     * @param string $plan
     * @return \Illuminate\Http\RedirectResponse
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__invoke</span><span class="token punctuation">(</span><span class="token keyword type-hint">string</span> <span class="token variable">$plan</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$user</span> <span class="token operator">=</span> <span class="token class-name static-context">Auth</span><span class="token operator">::</span><span class="token function">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token variable">$name</span> <span class="token operator">=</span> <span class="token function">ucfirst</span><span class="token punctuation">(</span><span class="token variable">$plan</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string single-quoted-string">' membership'</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token function">subscribed</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">,</span> <span class="token variable">$plan</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token variable">$result</span> <span class="token operator">=</span> <span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token function">newSubscription</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">,</span> <span class="token variable">$plan</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">is_a</span><span class="token punctuation">(</span><span class="token variable">$result</span><span class="token punctuation">,</span> <span class="token class-name static-context">RedirectToCheckoutResponse</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token variable">$result</span><span class="token punctuation">;</span> <span class="token comment">// Redirect to Mollie checkout</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">return</span> <span class="token function">back</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">with</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'status'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'Welcome to the '</span> <span class="token operator">.</span> <span class="token variable">$plan</span> <span class="token operator">.</span> <span class="token string single-quoted-string">' plan'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> <span class="token function">back</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">with</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'status'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'You are already on the '</span> <span class="token operator">.</span> <span class="token variable">$plan</span> <span class="token operator">.</span> <span class="token string single-quoted-string">' plan'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="enforcing-a-redirect-to-mollie-s-checkout"><a href="#enforcing-a-redirect-to-mollie-s-checkout" class="header-anchor">#</a> Enforcing a redirect to Mollie's checkout</h3> <p>In order to always enforce a redirect to the Mollie checkout page and obtain a new mandate, use the
<code>newSubscriptionViaMollieCheckout</code> method instead of <code>newSubscription</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">// make sure to configure the 'premium' plan in config/cashier.php</span>
<span class="token variable">$redirect</span> <span class="token operator">=</span> <span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token function">newSubscriptionViaMollieCheckout</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'main'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'premium'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="quantities"><a href="#quantities" class="header-anchor">#</a> Quantities</h3> <p>If you would like to set a specific quantity for the price when creating the subscription, you should invoke the
quantity method on the subscription builder before creating the subscription:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token function">newSubscription</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">,</span> <span class="token variable">$plan</span><span class="token punctuation">)</span>
    <span class="token operator">-&gt;</span><span class="token function">quantity</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
    <span class="token operator">-&gt;</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="coupons"><a href="#coupons" class="header-anchor">#</a> Coupons</h2> <p>Coupons allow you to apply special deals to subscriptions.</p> <p>If you would like to apply a coupon when creating the subscription, you may use the <code>withCoupon</code> method:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token function">newSubscription</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">,</span> <span class="token variable">$plan</span><span class="token punctuation">)</span>
    <span class="token operator">-&gt;</span><span class="token function">withCoupon</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'your-coupon-code'</span><span class="token punctuation">)</span>
    <span class="token operator">-&gt;</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The coupon will be validated when being applied and can throw a <code>Laravel\Cashier\Exceptions\CouponException</code>.</p> <h3 id="configuring-subscription-coupons"><a href="#configuring-subscription-coupons" class="header-anchor">#</a> Configuring subscription coupons</h3> <p>Coupons can be defined in <code>config/cashier_coupons.php</code>. Out of the box, a basic <code>FixedDiscountHandler</code> and
<code>PercentageDiscountHandler</code> are provided.</p> <p>Coupon handling in Cashier Mollie is designed with full flexibility in mind. You can provide your own coupon handler by extending
<code>\Cashier\Discount\BaseCouponHandler</code>.</p> <h3 id="redeeming-a-coupon-for-an-existing-subscription"><a href="#redeeming-a-coupon-for-an-existing-subscription" class="header-anchor">#</a> Redeeming a coupon for an existing subscription</h3> <p>For redeeming a coupon for an existing subscription, use the <code>redeemCoupon()</code> method on the billable trait:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token function">redeemCoupon</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'your-coupon-code'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>This will validate the coupon code and redeem it. The coupon will be applied to the upcoming Order.</p> <p>Optionally, specify the subscription it should be applied to:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token function">redeemCoupon</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'your-coupon-code'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'main'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>By default all other active redeemed coupons for the subscription will be revoked. You can prevent this by setting the
<code>$revokeOtherCoupons</code> flag to false:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token function">redeemCoupon</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'your-coupon-code'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'main'</span><span class="token punctuation">,</span> <span class="token constant boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="checking-subscription-status"><a href="#checking-subscription-status" class="header-anchor">#</a> Checking subscription status</h2> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token function">subscribed</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'main'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The <code>subscribed</code> method also makes a great candidate for a <a href="https://www.laravel.com/docs/middleware" target="_blank" rel="noopener noreferrer">route middleware<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>,
allowing you to filter access to routes and controllers based on the user's subscription status:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Middleware</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Closure</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">EnsureUserIsSubscribed</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
     * Handle an incoming request.
     *
     * @param  \Illuminate\Http\Request  $request
     * @param  \Closure  $next
     * @return mixed
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">handle</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">,</span> <span class="token class-name type-declaration">Closure</span> <span class="token variable">$next</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$request</span><span class="token operator">-&gt;</span><span class="token function">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span> <span class="token variable">$request</span><span class="token operator">-&gt;</span><span class="token function">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">subscribed</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'default'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// This user is not a paying customer...</span>
            <span class="token keyword">return</span> <span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'billing'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> <span class="token variable">$next</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre></div><p>If you would like to determine if a user is still within their trial period, you may use the <code>onTrial</code> method. This method can be useful for displaying a warning to the user that they are still on their trial period:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token function">subscription</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'main'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">onTrial</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The <code>subscribedToPlan</code> method may be used to determine if the user is subscribed to a given plan based on a configured plan. In this example, we will determine if the user's <code>main</code> subscription is actively subscribed to the <code>monthly</code> plan:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token function">subscribedToPlan</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'monthly'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'main'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="cancelled-subscription-status"><a href="#cancelled-subscription-status" class="header-anchor">#</a> Cancelled subscription status</h2> <p>To determine if the user was once an active subscriber, but has cancelled their subscription, you may use the <code>cancelled</code> method:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token function">subscription</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'main'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">cancelled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//</span>
<span class="token punctuation">}</span>
</code></pre></div><p>You may also determine if a user has cancelled their subscription, but are still on their &quot;grace period&quot; until the subscription fully expires. For example, if a user cancels a subscription on March 5th that was originally scheduled to expire on March 10th, the user is on their &quot;grace period&quot; until March 10th. Note that the <code>subscribed</code> method still returns <code>true</code> during this time:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token function">subscription</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'main'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">onGracePeriod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="changing-plans"><a href="#changing-plans" class="header-anchor">#</a> Changing plans</h2> <p>After a user is subscribed to your application, they may occasionally want to change to a new subscription plan.
To swap a user to a new subscription plan, pass the plan identifier to the <code>swap</code> or <code>swapNextCycle</code> method:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Models<span class="token punctuation">\</span>User</span><span class="token punctuation">;</span>

<span class="token variable">$user</span> <span class="token operator">=</span> <span class="token class-name class-name-fully-qualified static-context">App<span class="token punctuation">\</span>User</span><span class="token operator">::</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Swap right now</span>
<span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token function">subscription</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'main'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">swap</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'other-plan-id'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Swap once the current cycle has completed</span>
<span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token function">subscription</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'main'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">swapNextCycle</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'other-plan-id'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>If the user is on trial, the trial period will be maintained. Also, if a &quot;quantity&quot; exists for the subscription, that quantity will also be maintained.</p> <h2 id="subscription-quantity"><a href="#subscription-quantity" class="header-anchor">#</a> Subscription quantity</h2> <p>Sometimes subscriptions are affected by &quot;quantity&quot;. For example, your application might charge â‚¬10 per month
<strong>per seat</strong>. To easily increment or decrement the subscription quantity, use the <code>incrementQuantity</code>,
<code>decrementQuantity</code> and <code>updateQuantity</code> methods:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Models<span class="token punctuation">\</span>User</span><span class="token punctuation">;</span>

<span class="token variable">$user</span> <span class="token operator">=</span> <span class="token class-name class-name-fully-qualified static-context">App<span class="token punctuation">\</span>User</span><span class="token operator">::</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Increment the subscription quantity by one</span>
<span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token function">subscription</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'main'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">incrementQuantity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Add five to the subscription's current quantity...</span>
<span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token function">subscription</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'main'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">incrementQuantity</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Decrement the subscription quantity by one</span>
<span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token function">subscription</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'main'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">decrementQuantity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Subtract five to the subscription's current quantity...</span>
<span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token function">subscription</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'main'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">decrementQuantity</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Provide a specific subscription quantity</span>
<span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token function">subscription</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'main'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">updateQuantity</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="subscription-taxes"><a href="#subscription-taxes" class="header-anchor">#</a> Subscription taxes</h2> <p>To specify the tax percentage a user pays on a subscription, implement the <code>taxPercentage</code> method on your billable model, and return a numeric value between 0 and 100, with no more than 2 decimal places.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">taxPercentage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token number">20</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The <code>taxPercentage</code> method enables you to apply a tax rate on a model-by-model basis, which may be helpful for a user base that spans multiple countries and tax rates.</p> <h3 id="syncing-tax-percentages"><a href="#syncing-tax-percentages" class="header-anchor">#</a> Syncing tax percentages</h3> <p>When changing the hard-coded value returned by the <code>taxPercentage</code> method, the tax settings on any existing subscriptions for the user will remain the same. If you wish to update the tax value for existing subscriptions with the returned <code>taxPercentage</code> value, you should call the <code>syncTaxPercentage</code> method on the user's subscription instance:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token function">subscription</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'main'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">syncTaxPercentage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="cancelling-subscriptions"><a href="#cancelling-subscriptions" class="header-anchor">#</a> Cancelling subscriptions</h2> <p>To cancel a subscription, call the <code>cancel</code> method on the user's subscription:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token function">subscription</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'main'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">cancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>When a subscription is cancelled, Cashier will automatically set the <code>ends_at</code> column in your <code>subscriptions</code> database
table. This column is used to know when the <code>subscribed</code> method should begin returning <code>false</code>.</p> <p>For example, if a customer cancels a subscription on March 1st, but the subscription was not scheduled to end until
March 5th, the <code>subscribed</code> method will continue to return <code>true</code> until March 5th. This is done because a user is
typically allowed to continue using an application until the end of their billing cycle.</p> <p>You may determine if a user has cancelled their subscription and is still on their &quot;grace period&quot; using the <code>onGracePeriod</code> method:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token function">subscription</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'main'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">onGracePeriod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//</span>
<span class="token punctuation">}</span>
</code></pre></div><p>If you wish to cancel a subscription immediately, call the <code>cancelNow</code> method on the user's subscription:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token function">subscription</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'main'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">cancelNow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="resuming-subscriptions"><a href="#resuming-subscriptions" class="header-anchor">#</a> Resuming subscriptions</h2> <p>If a user has cancelled their subscription, and you wish to resume it, use the <code>resume</code> method.
The user <strong>must</strong> still be on their grace period in order to resume a subscription:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token function">subscription</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'main'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">resume</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>If a subscription gets cancelled and resumed before the subscription has fully expired, the user will not be billed
immediately. Instead, their subscription will be reactivated, and they will be billed on the original billing cycle.</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/sandorianHQ/laravel-cashier-mollie/edit/master/docs/02-subscriptions.md" target="_blank" rel="noopener noreferrer">Improve this page (submit a PR)</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">9/17/2021, 12:53:47 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      â†
      <a href="/laravel-cashier-mollie/13-upgrade.html" class="prev">
        Upgrade Guide
      </a></span> <span class="next"><a href="/laravel-cashier-mollie/03-trials.html">
        Subscription Trials
      </a>
      â†’
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/laravel-cashier-mollie/assets/js/app.d194e643.js" defer></script><script src="/laravel-cashier-mollie/assets/js/2.9546977a.js" defer></script><script src="/laravel-cashier-mollie/assets/js/11.400a032b.js" defer></script><script src="/laravel-cashier-mollie/assets/js/3.48b18616.js" defer></script>
  </body>
</html>
