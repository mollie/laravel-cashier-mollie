<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>F.A.Q. | Laravel Cashier Mollie v2</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/manifest.json">
    <script src="https://cdn.usefathom.com/script.js" spa="auto" site="ANMLOYPH" defer="true"></script>
    <meta name="description" content="Laravel Cashier provides an expressive, fluent interface to subscriptions using Mollie&#39;s billing services.">
    <meta name="theme-color" content="#ffffff">
    <meta name="viewport" content="width=device-width">
    
    <link rel="preload" href="/assets/css/0.styles.359cd878.css" as="style"><link rel="preload" href="/assets/js/app.6114c989.js" as="script"><link rel="preload" href="/assets/js/2.38511147.js" as="script"><link rel="preload" href="/assets/js/1.59beea3b.js" as="script"><link rel="preload" href="/assets/js/35.16f3d37b.js" as="script"><link rel="preload" href="/assets/js/19.ab717a18.js" as="script"><link rel="prefetch" href="/assets/js/10.6b754ae1.js"><link rel="prefetch" href="/assets/js/11.d9989b9f.js"><link rel="prefetch" href="/assets/js/12.b1fabc43.js"><link rel="prefetch" href="/assets/js/13.1cb5ee61.js"><link rel="prefetch" href="/assets/js/14.fe7a12cb.js"><link rel="prefetch" href="/assets/js/15.54cfc835.js"><link rel="prefetch" href="/assets/js/16.73fba09f.js"><link rel="prefetch" href="/assets/js/17.919259a1.js"><link rel="prefetch" href="/assets/js/18.dbf08a99.js"><link rel="prefetch" href="/assets/js/20.69ba80bc.js"><link rel="prefetch" href="/assets/js/21.d9e3d872.js"><link rel="prefetch" href="/assets/js/22.3d79b29e.js"><link rel="prefetch" href="/assets/js/23.a80aaaaf.js"><link rel="prefetch" href="/assets/js/24.5564df5a.js"><link rel="prefetch" href="/assets/js/25.fce0db21.js"><link rel="prefetch" href="/assets/js/26.8e47b26b.js"><link rel="prefetch" href="/assets/js/27.09e2c9e4.js"><link rel="prefetch" href="/assets/js/28.32777cd2.js"><link rel="prefetch" href="/assets/js/29.1e2c0676.js"><link rel="prefetch" href="/assets/js/3.b11f09c4.js"><link rel="prefetch" href="/assets/js/30.d6d98a47.js"><link rel="prefetch" href="/assets/js/31.5daabc3a.js"><link rel="prefetch" href="/assets/js/32.23fa1041.js"><link rel="prefetch" href="/assets/js/33.70daf56c.js"><link rel="prefetch" href="/assets/js/34.60612968.js"><link rel="prefetch" href="/assets/js/36.d5cfe1fe.js"><link rel="prefetch" href="/assets/js/37.e9d0b5f2.js"><link rel="prefetch" href="/assets/js/38.d97231ff.js"><link rel="prefetch" href="/assets/js/39.1290114d.js"><link rel="prefetch" href="/assets/js/4.b16263cd.js"><link rel="prefetch" href="/assets/js/40.5c0a2311.js"><link rel="prefetch" href="/assets/js/5.280719b2.js"><link rel="prefetch" href="/assets/js/6.b85cedd4.js"><link rel="prefetch" href="/assets/js/7.b1184ded.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.38ba84f9.js">
    <link rel="stylesheet" href="/assets/css/0.styles.359cd878.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/assets/img/cashier-mollie.svg" alt="Laravel Cashier Mollie v2" class="logo"> <span class="site-name can-hide">Laravel Cashier Mollie v2</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"> <a href="https://github.com/mollie/laravel-cashier-mollie" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/mollie/laravel-cashier-mollie" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/" aria-current="page" class="sidebar-link">Introduction</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/01-installation.html" class="sidebar-link">Installation</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/01-installation.html#setup" class="sidebar-link">Setup</a></li></ul></li><li><a href="/13-upgrade.html" class="sidebar-link">Upgrade Guide</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/13-upgrade.html#preparations" class="sidebar-link">Preparations</a></li><li class="sidebar-sub-header"><a href="/13-upgrade.html#upgrading-to-2-0-from-1-x" class="sidebar-link">Upgrading To 2.0 From 1.x</a></li></ul></li><li><a href="/16-configuration.html" class="sidebar-link">Configuration</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/16-configuration.html#custom-models" class="sidebar-link">Custom Models</a></li></ul></li><li><a href="/02-subscriptions.html" class="sidebar-link">Subscriptions</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/02-subscriptions.html#creating-subscriptions" class="sidebar-link">Creating subscriptions</a></li><li class="sidebar-sub-header"><a href="/02-subscriptions.html#coupons" class="sidebar-link">Coupons</a></li><li class="sidebar-sub-header"><a href="/02-subscriptions.html#checking-subscription-status" class="sidebar-link">Checking subscription status</a></li><li class="sidebar-sub-header"><a href="/02-subscriptions.html#cancelled-subscription-status" class="sidebar-link">Cancelled subscription status</a></li><li class="sidebar-sub-header"><a href="/02-subscriptions.html#changing-plans" class="sidebar-link">Changing plans</a></li><li class="sidebar-sub-header"><a href="/02-subscriptions.html#subscription-quantity" class="sidebar-link">Subscription quantity</a></li><li class="sidebar-sub-header"><a href="/02-subscriptions.html#subscription-taxes" class="sidebar-link">Subscription taxes</a></li><li class="sidebar-sub-header"><a href="/02-subscriptions.html#cancelling-subscriptions" class="sidebar-link">Cancelling subscriptions</a></li><li class="sidebar-sub-header"><a href="/02-subscriptions.html#resuming-subscriptions" class="sidebar-link">Resuming subscriptions</a></li><li class="sidebar-sub-header"><a href="/02-subscriptions.html#subscription-scopes" class="sidebar-link">Subscription Scopes</a></li></ul></li><li><a href="/03-trials.html" class="sidebar-link">Subscription Trials</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/03-trials.html#with-mandate-upfront" class="sidebar-link">With mandate upfront</a></li><li class="sidebar-sub-header"><a href="/03-trials.html#without-mandate-upfront" class="sidebar-link">Without mandate upfront</a></li></ul></li><li><a href="/04-charges.html" class="sidebar-link">Charges</a></li><li><a href="/05-metered.html" class="sidebar-link">Metered billing</a></li><li><a href="/06-customer.html" class="sidebar-link">Customer</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/06-customer.html#updating-customer-payment-method" class="sidebar-link">Updating customer payment method</a></li><li class="sidebar-sub-header"><a href="/06-customer.html#customer-balance" class="sidebar-link">Customer balance</a></li><li class="sidebar-sub-header"><a href="/06-customer.html#customer-locale" class="sidebar-link">Customer locale</a></li></ul></li><li><a href="/07-invoices.html" class="sidebar-link">Invoices</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/07-invoices.html#finding-a-specific-invoice" class="sidebar-link">Finding a specific invoice</a></li></ul></li><li><a href="/08-refunds.html" class="sidebar-link">Refunds</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/08-refunds.html#performing-a-complete-refund" class="sidebar-link">Performing a complete refund</a></li><li class="sidebar-sub-header"><a href="/08-refunds.html#performing-advanced-refunds" class="sidebar-link">Performing advanced refunds</a></li><li class="sidebar-sub-header"><a href="/08-refunds.html#credit-orders-and-invoices" class="sidebar-link">Credit orders and invoices</a></li></ul></li><li><a href="/14-retry.html" class="sidebar-link">Handling failed payments</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/14-retry.html#subscriptions-and-failed-payments" class="sidebar-link">Subscriptions and failed payments</a></li></ul></li><li><a href="/09-events.html" class="sidebar-link">Events</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/15-localization.html" class="sidebar-link">Localization</a></li><li><a href="/10-webhook.html" class="sidebar-link">Mollie webhook event handling</a></li><li><a href="/11-testing.html" class="sidebar-link">Testing</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/11-testing.html#enable-mollie-integration-tests" class="sidebar-link">Enable Mollie integration tests</a></li></ul></li><li><a href="/12-faq.html" aria-current="page" class="active sidebar-link">F.A.Q.</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/12-faq.html#ok-so-how-does-this-subscription-magic-actually-work" class="sidebar-link">Ok. So how does this subscription magic actually work?</a></li><li class="sidebar-sub-header"><a href="/12-faq.html#my-billable-model-uses-uuids-how-can-i-get-cashier-mollie-to-work-with-this" class="sidebar-link">My billable model uses UUIDs, how can I get Cashier Mollie to work with this?</a></li><li class="sidebar-sub-header"><a href="/12-faq.html#how-is-prorating-handled" class="sidebar-link">How is prorating handled?</a></li><li class="sidebar-sub-header"><a href="/12-faq.html#how-can-i-load-coupons-and-or-plans-from-the-database" class="sidebar-link">How can I load coupons and/or plans from the database?</a></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="f-a-q"><a href="#f-a-q" class="header-anchor">#</a> F.A.Q.</h1> <h2 id="ok-so-how-does-this-subscription-magic-actually-work"><a href="#ok-so-how-does-this-subscription-magic-actually-work" class="header-anchor">#</a> Ok. So how does this subscription magic actually work?</h2> <p>This Cashier implementation schedules triggering payments from the client side, instead of relying on subscription management at Mollie.
And yes, Mollie also offers a Subscription API, but it does not support all the niceties you've come to expect from Cashier,
so this package provides its own subscription engine.</p> <p>From a high level perspective, this is what the process looks like:</p> <ol><li>A <code>Subscription</code> is created using the <code>MandatePaymentSubscriptionBuilder</code> (redirecting to Mollie's checkout to create
a <code>Mandate</code>) or <code>PremandatedSubscriptionBuilder</code> (using an existing <code>Mandate</code>).</li> <li>The <code>Subscription</code> yields a scheduled <code>OrderItem</code> at the beginning of each billing cycle.</li> <li><code>OrderItems</code> which are due are preprocessed and bundled into <code>Orders</code> whenever possible by a scheduled job (i.e.
daily). This is done, so your customer will receive a single payment/invoice for multiple items later on in the chain).
Preprocessing the <code>OrderItems</code> may involve applying dynamic discounts or metered billing, depending on your
configuration.</li> <li>The <code>Order</code> is processed by the same scheduled job into a payment:
<ul><li>First, (if available) the customer's balance is processed in the <code>Order</code>.</li> <li>If the total due is positive, a Mollie payment is incurred.</li> <li>If the total due is 0, nothing happens.</li> <li>If the total due is negative, the amount is added to the user's balance. If the user has no active subscriptions left, the <code>BalanceTurnedStale</code> event will be raised.</li></ul></li> <li>You can generate an <code>Invoice</code> (html/pdf) for the user.</li></ol> <h2 id="my-billable-model-uses-uuids-how-can-i-get-cashier-mollie-to-work-with-this"><a href="#my-billable-model-uses-uuids-how-can-i-get-cashier-mollie-to-work-with-this" class="header-anchor">#</a> My billable model uses UUIDs, how can I get Cashier Mollie to work with this?</h2> <p>By default Cashier Mollie uses <code>unsignedInteger</code> fields for the billable model relationships.
If required for your billable model, modify the cashier migrations for UUIDs:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">// Replace this:</span>
<span class="token variable">$table</span><span class="token operator">-&gt;</span><span class="token function">unsignedInteger</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'owner_id'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// By this:</span>
<span class="token variable">$table</span><span class="token operator">-&gt;</span><span class="token function">uuid</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'owner_id'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>And in your <code>Billable</code> model add</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">protected</span> <span class="token variable">$keyType</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'string'</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="how-is-prorating-handled"><a href="#how-is-prorating-handled" class="header-anchor">#</a> How is prorating handled?</h2> <p>Cashier Mollie applies prorating by default. With prorating, customers are billed at the start of each billing cycle.</p> <p>This means that when the subscription quantity is updated or is switched to another plan:</p> <ol><li>the billing cycle is reset</li> <li>the customer is credited for unused time, meaning that the amount that was overpaid is added to the customer's balance.</li> <li>a new billing cycle is started with the new subscription settings. An Order (and payment) is generated to deal with
all the previous, including applying the credited balance to the Order.</li></ol> <p>This does not apply to the <code>$subscription-&gt;swapNextCycle('other-plan')</code>, which simply waits for the next billing cycle
to update the subscription plan. A common use case for this is downgrading the plan at the end of the billing cycle.</p> <h2 id="how-can-i-load-coupons-and-or-plans-from-the-database"><a href="#how-can-i-load-coupons-and-or-plans-from-the-database" class="header-anchor">#</a> How can I load coupons and/or plans from the database?</h2> <p>Because Cashier Mollie uses contracts a lot it's quite easy to extend Cashier Mollie and use your own implementations.
You can load coupons/plans from database, a file or even a JSON API.</p> <p>For example a simple implementation of plans from the database:</p> <p>Firstly you create your own implementation of the plan repository and implement <code>Laravel\Cashier\Plan\Contracts\PlanRepository</code>.
Implement the methods according to your needs and make sure you'll return a <code>Laravel\Cashier\Plan\Contracts\Plan</code>.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Models<span class="token punctuation">\</span>Plan</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Laravel<span class="token punctuation">\</span>Cashier<span class="token punctuation">\</span>Exceptions<span class="token punctuation">\</span>PlanNotFoundException</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Laravel<span class="token punctuation">\</span>Cashier<span class="token punctuation">\</span>Plan<span class="token punctuation">\</span>Contracts<span class="token punctuation">\</span>Plan</span> <span class="token keyword">as</span> PlanContract<span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Laravel<span class="token punctuation">\</span>Cashier<span class="token punctuation">\</span>Plan<span class="token punctuation">\</span>Contracts<span class="token punctuation">\</span>PlanRepository</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">DatabasePlanRepository</span> <span class="token keyword">implements</span> <span class="token class-name">PlanRepository</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">function</span> <span class="token function-definition function">find</span><span class="token punctuation">(</span><span class="token keyword type-hint">string</span> <span class="token variable">$name</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token class-name return-type">PlanContract</span>
    <span class="token punctuation">{</span>
        <span class="token comment">/** @var Plan $plan */</span>
        <span class="token variable">$plan</span> <span class="token operator">=</span> <span class="token class-name static-context">Plan</span><span class="token operator">::</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">,</span> <span class="token variable">$name</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">firstOrFail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Return a \Laravel\Cashier\Plan\Plan by creating one from the database values</span>
        <span class="token keyword">return</span> <span class="token variable">$plan</span><span class="token operator">-&gt;</span><span class="token function">buildCashierPlan</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Or if your model implements the contract: \Laravel\Cashier\Plan\Contracts\Plan</span>
        <span class="token keyword">return</span> <span class="token variable">$plan</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">function</span> <span class="token function-definition function">findOrFail</span><span class="token punctuation">(</span><span class="token keyword type-hint">string</span> <span class="token variable">$name</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token class-name return-type">PlanContract</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token variable">$result</span> <span class="token operator">=</span> <span class="token keyword static-context">self</span><span class="token operator">::</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token constant">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">PlanNotFoundException</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> <span class="token variable">$result</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><details class="custom-block details"><summary>Example Plan model (app/Plan.php) with buildCashierPlan and returns a \Laravel\Cashier\Plan\Plan</summary> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Models</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Database<span class="token punctuation">\</span>Eloquent<span class="token punctuation">\</span>Factories<span class="token punctuation">\</span>HasFactory</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Database<span class="token punctuation">\</span>Eloquent<span class="token punctuation">\</span>Model</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Laravel<span class="token punctuation">\</span>Cashier<span class="token punctuation">\</span>Cashier</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Laravel<span class="token punctuation">\</span>Cashier<span class="token punctuation">\</span>Plan<span class="token punctuation">\</span>Plan</span> <span class="token keyword">as</span> CashierPlan<span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Money<span class="token punctuation">\</span>Currency</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Money<span class="token punctuation">\</span>Money</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Laravel<span class="token punctuation">\</span>Cashier<span class="token punctuation">\</span>Order<span class="token punctuation">\</span>OrderItemPreprocessorCollection</span> <span class="token keyword">as</span> Preprocessors<span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">Plan</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">{</span>
    <span class="token keyword">use</span> <span class="token package">HasFactory</span><span class="token punctuation">;</span>

    <span class="token comment">/**
     * Builds a Cashier plan from the current model.
     *
     * @returns \Laravel\Cashier\Plan\Plan
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">buildCashierPlan</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token class-name return-type">CashierPlan</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$plan</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CashierPlan</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">name</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> <span class="token variable">$plan</span><span class="token operator">-&gt;</span><span class="token function">setAmount</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">getAmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token operator">-&gt;</span><span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">interval</span><span class="token punctuation">)</span>
            <span class="token operator">-&gt;</span><span class="token function">setDescription</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">description</span><span class="token punctuation">)</span>
            <span class="token operator">-&gt;</span><span class="token function">setFirstPaymentMethod</span><span class="token punctuation">(</span><span class="token function">config</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'cashier.first_payment.method'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token operator">-&gt;</span><span class="token function">setFirstPaymentAmount</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">getAmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token operator">-&gt;</span><span class="token function">setFirstPaymentDescription</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">description</span><span class="token punctuation">)</span>
            <span class="token operator">-&gt;</span><span class="token function">setFirstPaymentRedirectUrl</span><span class="token punctuation">(</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'plans-payment.success'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">'plan'</span> <span class="token operator">=&gt;</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">id</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token operator">-&gt;</span><span class="token function">setFirstPaymentWebhookUrl</span><span class="token punctuation">(</span><span class="token class-name static-context">Cashier</span><span class="token operator">::</span><span class="token function">firstPaymentWebhookUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token operator">-&gt;</span><span class="token function">setOrderItemPreprocessors</span><span class="token punctuation">(</span><span class="token class-name static-context">Preprocessors</span><span class="token operator">::</span><span class="token function">fromArray</span><span class="token punctuation">(</span><span class="token function">config</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'cashier_plans.defaults.order_item_preprocessors'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">function</span> <span class="token function-definition function">getAmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token class-name return-type">Money</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Money</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">price</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Currency</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">currency</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The DB-schema for the above Model could look like the following.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token class-name static-context">Schema</span><span class="token operator">::</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'plans'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token class-name type-declaration">Blueprint</span> <span class="token variable">$table</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token variable">$table</span><span class="token operator">-&gt;</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token variable">$table</span><span class="token operator">-&gt;</span><span class="token keyword type-declaration">string</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token variable">$table</span><span class="token operator">-&gt;</span><span class="token keyword type-declaration">string</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'description'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token variable">$table</span><span class="token operator">-&gt;</span><span class="token keyword type-declaration">string</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'price'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token variable">$table</span><span class="token operator">-&gt;</span><span class="token keyword type-declaration">string</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'currency'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token variable">$table</span><span class="token operator">-&gt;</span><span class="token keyword type-declaration">string</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'interval'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token variable">$table</span><span class="token operator">-&gt;</span><span class="token function">timestamps</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>You can also create a <code>PlanFactory</code>.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">class</span> <span class="token class-name-definition class-name">PlanFactory</span> <span class="token keyword">extends</span> <span class="token class-name">Factory</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
     * Define the model's default state.
     *
     * @return array&lt;string, mixed&gt;
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">definition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">array</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">[</span>
            <span class="token string single-quoted-string">'name'</span> <span class="token operator">=&gt;</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">faker</span><span class="token operator">-&gt;</span><span class="token property">name</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'description'</span> <span class="token operator">=&gt;</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">faker</span><span class="token operator">-&gt;</span><span class="token property">sentence</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'price'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'10.00'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'currency'</span> <span class="token operator">=&gt;</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">faker</span><span class="token operator">-&gt;</span><span class="token property">currencyCode</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'interval'</span> <span class="token operator">=&gt;</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">faker</span><span class="token operator">-&gt;</span><span class="token function">randomElement</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'month'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'year'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></details> <p>Then you have to bind your implementation to the Laravel/Illuminate container by registering the binding in a service provider</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">class</span> <span class="token class-name-definition class-name">AppServiceProvider</span> <span class="token keyword">extends</span> <span class="token class-name">ServiceProvider</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">register</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">app</span><span class="token operator">-&gt;</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token class-name class-name-fully-qualified static-context"><span class="token punctuation">\</span>Laravel<span class="token punctuation">\</span>Cashier<span class="token punctuation">\</span>Plan<span class="token punctuation">\</span>Contracts<span class="token punctuation">\</span>PlanRepository</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name static-context">DatabasePlanRepository</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>In order to test if your implementation is setup correctly, you can run the following code snippet.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">Laravel<span class="token punctuation">\</span>Cashier<span class="token punctuation">\</span>Plan<span class="token punctuation">\</span>Contracts<span class="token punctuation">\</span>PlanRepository</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Models<span class="token punctuation">\</span>Plan</span><span class="token punctuation">;</span>

<span class="token class-name static-context">Plan</span><span class="token operator">::</span><span class="token function">factory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string double-quoted-string">&quot;name&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;test&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">resolve</span><span class="token punctuation">(</span><span class="token class-name static-context">PlanRepository</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;test&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><hr> <p>Cashier Mollie will now use your implementation of the PlanRepository. For coupons this is basically the same,
make sure you implement the CouponRepository contract and bind the contract to your own implementation.</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/mollie/laravel-cashier-mollie/edit/main/docs/12-faq.md" target="_blank" rel="noopener noreferrer">Improve this page (submit a PR)</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">6/24/2024, 8:22:36 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/11-testing.html" class="prev">
        Testing
      </a></span> <!----></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.6114c989.js" defer></script><script src="/assets/js/2.38511147.js" defer></script><script src="/assets/js/1.59beea3b.js" defer></script><script src="/assets/js/35.16f3d37b.js" defer></script><script src="/assets/js/19.ab717a18.js" defer></script>
  </body>
</html>
